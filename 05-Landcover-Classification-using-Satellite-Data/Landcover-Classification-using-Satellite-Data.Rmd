---
title: "Landcover Classification using Satellite Data"
author: "S&DS 361"
date: "2024-02-29"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction

Satellite data can be used to estimate the type of landcover (built-up, cropland, natural forest, orchard) at locations around the world. This approach can be an time and cost effective alternative to manually inspecting these locations in person. 

## Data

The data `labeled_points.Rdata` contains data on blocks of land in Benin.

```{r}
load('data/labeled_points.Rdata')
```

The file contains two data frames. 

**1. labeled.** The object `labeled` has 400 locations (with unique identifier `ID`). The `landcover` type at each location has been manually labeled by a human. Each `ID` has a unique latitude (`lat`) and longitude (`lon`) and can be thought of as a pixel in an image. 

```{r}
head(labeled,2) %>%
  as.data.frame()
```

The four labels are 

- **natforest.** natural vegetation
- **cropland.** annual, ground-based crops.
- **orchard.** tree crops
- **builtup.** buildings or roads. 


**2. labeled_train.** The object `labeled_train` has 3 years of satellite imagery for each `ID`. Images were collected every 16 days, and the `year`, `month`, `day`, and `date` for each location are given in the data. These were all taken by the [Landsat 7](https://www.usgs.gov/landsat-missions/landsat-7) satellite. The other columns are 

- **ID.** Unique identifier for the location, same as in `labeled`.
- **B1 thru B8.** These are 8 bands from the image, including a red band, green band, blue band, infrared band, etc.  These measure the strength of the red, green, and blue wavelengths in an image as well as the strength of other wavelengths on the electromagnetic spectrum that are not visible to the human eye. You can find more information about these on the [Landsat 7](https://www.usgs.gov/landsat-missions/landsat-7) page.
- **NDVI.** [Normalized Difference Vegetation Index](https://gisgeography.com/ndvi-normalized-difference-vegetation-index/). The Normalized Difference Vegetation Index (NDVI) is a common index used for summarizing satellite image data. According to its [Wikipedia](https://en.wikipedia.org/wiki/Normalized_difference_vegetation_index#:~:text=The%20normalized%20difference%20vegetation%20index,observed%20contains%20live%20green%20vegetation) page, NDVI "is a simple graphical indicator that can be used to analyze remote sensing measurements, often from a space platform, assessing whether or not the target being observed contains live green vegetation."  Note that the formula given on that page is $$ NDVI = \frac{NIR - Red}{NIR + Red} $$ The data you've been given contains both the NIR (near-infrared) and Red bands (bands 4 and 3, respectively, according to https://www.usgs.gov/landsat-missions/landsat-7). 
- **NDBI.** Normal Difference Built-up Index. Like NDVI, but for detecting built-up areas.
- **EVI.** Enhanced Vegetation Index. Like NDVI, but performs better under [some conditions](https://www.usgs.gov/landsat-missions/landsat-enhanced-vegetation-index).

```{r}
labeled_train %>%
  as.data.frame() %>%
  head(2)
```

These band values will be different depending on the landcover type. Some known relationships

- NDVI is known to be a very good indicator of vegetation
- The band values show seasonal trends, since landcover can show seasonal changes (e.g. trees lose their leaves in the fall)
- The peaks and troughs can be shifted in time for different landcover types (different types of vegetation peak at different times).
- The difference between peaks and troughs can vary among landcover types. 

We can join these data sets on `ID`. 

```{r}
labeled = labeled %>% 
  select(ID, landcover)

d = labeled_train %>%
  left_join(labeled, by = 'ID')
```

Finally, let's add a column for vegetation called `veg` that is 1 if the `landcover` is `natforest`, `orchard`, or `cropland`, and 0 otherwise. 

```{r}
d = d %>%
  mutate(veg = ifelse(landcover %in% c('natforest', 'orchard', 'cropland'), 
                      1, 0), 
         builtup = ifelse(landcover == 'builtup', 1, 0), 
         EVI = ifelse(is.infinite(EVI), NA, EVI))
```

## Vegetation and band values

It will likely be helpful to perform data exploration and visualization to determine which bands vary the most among landcover types, which bands are relatively similar across landcover types, and to detect other potential trends in the data. Let's start by focusing on `veg` and exploring the relationship between `veg` and the band values. 



## Vegetation classification




## Landcover types and band values



## Landcover classification


